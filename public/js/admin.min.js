import{DynamicScript,theme,wallet,price,network,cookies,Modal,api,startHeaderApiSearch}from"./utils.min.js";startHeaderApiSearch(),new DynamicScript("https://kit.fontawesome.com/c1a16f97ec.js"),theme.load(),document.querySelector("#theme").addEventListener("click",()=>theme.toggle());const obj=document.querySelector("#network-btn");obj.classList.add(network.get().symbol),obj.querySelector(".name").innerHTML=network.get().name,obj.querySelector(".icon").src=`img/${network.get().symbol}.png`,obj.addEventListener("click",(function(){const dropdown=document.createElement("div");dropdown.id="dropdown",dropdown.innerHTML=Object.entries(network.getList()).map(([k,v])=>`<div id="${k}" class="item"><a href="/${k}"><img class="icon" src="img/${k}.png"><span class="name">${v.name}</span></a></div>`).join(""),dropdown.style.top=`${this.offsetTop+this.clientHeight}px`,dropdown.style.left=`${this.offsetLeft+this.clientWidth-130}px`;const fog=document.createElement("div");fog.id="fog",fog.classList.add("invisible"),document.body.appendChild(fog),fog.appendChild(dropdown),fog.addEventListener("click",()=>fog.remove())})),document.querySelectorAll(".token-name").forEach(e=>e.innerHTML=network.get().token),document.querySelectorAll(".chain-symbol").forEach(e=>e.innerHTML=network.get().symbol),document.querySelectorAll(".chain-name").forEach(e=>e.innerHTML=network.get().name),price.token=network.get().token,price.update(),setInterval(()=>price.update(),1e4);const explorer=document.querySelector("footer .resources #explorer");explorer.href=network.get().explorer.href,explorer.querySelector("img").src=network.get().explorer.icon,explorer.querySelector(".name").innerHTML=network.get().explorer.name,wallet.loadImg(document.querySelector("#donate"),network.get()),document.querySelectorAll(".donate-link").forEach(e=>wallet.bindModal(e,network.get()));const menuButton=document.querySelectorAll("header .col")[0];menuButton.insertAdjacentHTML("afterbegin",'<div id="menu-button"><i class="fa-solid fa-bars"></i></div>'),menuButton.addEventListener("click",()=>{document.querySelector("#fog.menu.hidden").classList.remove("hidden")});const fogMenu=document.querySelector("#fog.menu");fogMenu.addEventListener("click",()=>fogMenu.classList.add("hidden"));const session={get:function(){return cookies.get("session")},set:function(id){cookies.set("session",id,{expires:{hours:1}})},delete:function(){cookies.delete("session")},validate:async function(password){let body={password:password};if(!password&&(body={currentSession:this.get()},!this.get()))return!1;const data=await api.request("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});return data.error?(this.delete(),data):(this.set(data.sessionId),data)},login:async function(){const buttonPress=async modal=>{const value=modal.domObject.querySelector("input").value.trim();if(value.length>0){const button=modal.domObject.querySelector("button");button.innerHTML='<i class="fas fa-spin fa-cog"></i>',button.setAttribute("disabled",!0),modal.domObject.querySelector("input").setAttribute("disabled",!0);const data=await this.validate(value);if(data.error)return void new Modal(`<h2>${data.error}</h2>\n                        <p>${data.message}</p>\n                        <div id="button-container"><button id="close">OK</button></div>`,{fog:{dark:!0}}).addEvent({tag:"button",event:"click",callback:()=>this.login()});this.set(data.sessionId),modal.close(),this.loaded=!0}},modal=new Modal('<h2>Admin Login</h2>\n            <div class="input-container">\n                <input class="input-text" type="password">\n                <button class="input-button"><i class="fas fa-sign-in-alt"></i></button>\n            </div>\n        ',{id:"admin-login",fog:{close:!1,dark:!0}});modal.addEvent({tag:"button",event:"click",callback:()=>buttonPress(modal)}),modal.addEvent({class:"input-text",event:"keyup",callback:e=>{"Enter"==e.key&&buttonPress(modal)}})},check:async function(){const data=await this.validate();return!data||data.error?(this.delete(),this.login(),await new Promise(resolve=>{const monitor=()=>{this.loaded?resolve(!0):setTimeout(()=>monitor(),100)};monitor()})):(this.set(data.sessionId),!0)}};session.check().then(async()=>{await chart.init(),document.querySelector("#timeframe-switcher #tf-h").click(),theme.onChange=()=>{chart.setTheme(cookies.get("theme")||"dark")},theme.set(cookies.get("theme")||"dark")});const chart={package:import("https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"),ready:!1,timeframe:60,page:1,candles:1e3,lastCandle:((new Date).getTime()/1e3).toFixed(0),allRead:!1,network:network.get().symbol,init:async function(){await this.package,document.querySelector("#chart").innerHTML="",this.obj=LightweightCharts.createChart(document.querySelector("#chart"),{width:Math.min(document.querySelector("#frame").offsetWidth-20,600),height:300,crosshair:{mode:LightweightCharts.CrosshairMode.Normal},timeScale:{timeVisible:!0,secondsVisible:!1}}),window.addEventListener("resize",()=>{this.obj.resize(Math.min(document.querySelector("#frame").offsetWidth-20,600),300)}),this.series,document.querySelectorAll("#timeframe-switcher button").forEach(b=>b.addEventListener("click",async()=>{document.querySelectorAll("#timeframe-switcher button").forEach(e=>e.classList.remove("active"));const text=b.innerHTML;b.innerHTML='<i class="fas fa-spin fa-cog"></i>';const tf=b.id.split("tf-")[1],ntw=Array.from(document.querySelectorAll("#network-switcher button")).filter(e=>e.classList.contains("active"))[0].id.split("ntw-")[1],history=await this.getHistory({timeframe:tf,network:ntw});b.classList.add("active"),b.innerHTML=text,this.update(history)})),document.querySelectorAll("#network-switcher button").forEach(b=>b.addEventListener("click",async()=>{document.querySelectorAll("#network-switcher button").forEach(e=>e.classList.remove("active"));const text=b.innerHTML;b.innerHTML='<i class="fas fa-spin fa-cog"></i>';const tf=Array.from(document.querySelectorAll("#timeframe-switcher button")).filter(e=>e.classList.contains("active"))[0].id.split("tf-")[1],ntw=b.id.split("ntw-")[1],history=await this.getHistory({timeframe:tf,network:ntw});b.classList.add("active"),b.innerHTML=text,this.update(history)})),this.timeScale=this.obj.timeScale(),this.timeScale.subscribeVisibleLogicalRangeChange(async()=>{const logicalRange=this.timeScale.getVisibleLogicalRange();if(null!==logicalRange&&logicalRange.from<0&&this.history.length>=this.candles&&!this.scrolling&&!this.allRead){this.scrolling=!0;const oldHistory=this.history,newHistory=await this.getHistory({timeframe:this.timeframe,page:this.page+1,network:ntw});this.history=[...oldHistory,...newHistory],this.update(this.history),this.page++,this.scrolling=!1,0==newHistory.length&&(this.allRead=!0)}}),this.ready=!0},update:function(data){if(data.length){const speedData=data.map(e=>({time:parseInt(new Date(e.timestamp).getTime()/1e3),value:e.requests})).reverse();this.series||(this.series=this.obj.addLineSeries()),this.series.setData(speedData)}},setTheme:function(name){let background="#232323",text="#e3dcd0",lines="#3c3c3c";"light"==name&&(background="#eeeeee",text="#511814",lines="#c9c9c9"),this.isReady().then(()=>{this.obj.applyOptions({layout:{backgroundColor:background,textColor:text},grid:{vertLines:{color:lines},horzLines:{color:lines}},rightPriceScale:{borderColor:lines},timeScale:{borderColor:lines}})})},getHistory:async function({timeframe:timeframe=60,page:page=1,candles:candles=this.candles,network:network}){return network=network&&"all"!=network?`&network=${network}`:"",this.timeframe=timeframe,this.history=await api.request(`/admin/requests?timeframe=${timeframe}&currentSession=${session.get()}${network}`),this.history.error?(console.log(this.history),new Modal(`<h2>${this.history.error}</h2>\n                <p>${this.history.message}</p>\n                <div id="button-container"><button id="close">OK</button></div>`,{fog:{dark:!0}}).addEvent({tag:"button",event:"click",callback:()=>session.login()}),401==this.history.error.status?this.getHistory({timeframe:timeframe,page:page,candles:candles,network:network}):[]):this.history.results},isReady:async function(){return this.ready||new Promise(resolve=>setTimeout(()=>resolve(this.isReady()),10))}};document.querySelectorAll("#side-menu .item").forEach((e,i)=>e.addEventListener("click",()=>{const content=document.querySelectorAll("#content .menu-content");content.forEach(e=>e.classList.remove("active")),content[i].classList.add("active"),e.parentNode.querySelectorAll(".item").forEach(e=>e.classList.remove("active")),e.classList.add("active")})),document.querySelector("#side-menu #requests").click();const creditTable={input:document.querySelector("#content #key input"),checkBtn:document.querySelector("#content #key #check"),table:document.querySelector("#content #key #wallet-table"),pageLeft:document.querySelector("#content #key #page-container #left"),pageRight:document.querySelector("#content #key #page-container #right"),data:{input:"",order:"desc",field:"usage",page:0},init:function(){this.input.addEventListener("input",()=>{if(this.input.value.length>0){let sliced=this.input.value;this.input.value.length>=11&&(sliced=(this.input.value.slice(0,6)+"..."+this.input.value.slice(-4)).toLowerCase()),this.checkBtn.innerHTML=`Check ${sliced}`}else this.checkBtn.innerHTML="Check all";this.data.input=this.input.value}),this.checkBtn.addEventListener("click",async()=>{if(this.checkBtn.hasAttribute("disabled"))return;this.checkBtn.setAttribute("disabled",!0),this.checkBtn.innerHTML='<i class="fas fa-spin fa-cog"></i>',this.table.innerHTML='<div><i class="fas fa-spin fa-cog"></i></div>';const data=await this.check();data.error?console.log(data):(this.checkBtn.removeAttribute("disabled"),this.checkBtn.innerHTML="Check")})},check:async function(){const value=this.data.input;let query={};query.order=this.data.order,query.field=this.data.field,query.page=this.data.page,value.length&&(query.id=value),query=new URLSearchParams(query).toString();const data=await api.request(`/admin/credit${query.length?`?${query}`:""}`);let tableHTML='\n            <div class="cell head">Id</div>\n            <div class="cell head">Origin</div>\n            <div class="cell head">Note</div>\n            <div class="cell head">Credit <span id="credit" class="sort"><i class="fas fa-sort"></i></span></div>\n            <div class="cell head">Usage 1D<span id="usage" class="sort"><i class="fas fa-sort"></i></span></div>\n            <div class="cell head">Time Checked <span id="time" class="sort"><i class="fas fa-sort"></i></span></div>\n        ';return tableHTML+=data.results.map(e=>`\n            <div class="cell">${e.id}</div>\n            <div class="cell text">${e.origin}</div>\n            <div class="cell text">${e.note}</div>\n            <div class="cell">${e.credit}</div>\n            <div class="cell">${e.key_use}</div>\n            <div class="cell">${e.timeChecked}</div>\n        `).join(""),this.table.innerHTML=tableHTML,this.table.querySelectorAll(".head .sort").forEach(e=>e.addEventListener("click",async()=>{this.data.field==e.id&&(this.data.order="desc"==this.data.order?"asc":"desc"),this.data.field=e.id;const text=e.innerHTML;e.innerHTML='<div><i class="fas fa-spin fa-cog"></i></div>',await this.check(),e.innerHTML=text})),data}};creditTable.init();
//# sourceMappingURL=admin.min.js.map